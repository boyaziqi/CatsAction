title: 缓存问题及处理
subtitle: 分布式部署
date: 2017-01-22
status: draft
category: Cache
tags: Redis,Memcached

#### Memcached和Redis对比
- Memcached是单进程多线性，而Redis是单进程单线程。
- Memcached不持久化数据，Redis可以配置数据持久化到磁盘。
- Memcahced不存在对事务的支持，Redis支持基本的事务，但是失败不回滚，即不保证原子性。
- Memcached只支持存储简单的key-value数据类型，Redis支持string，list，hash，set，sorted set等丰富的数据类型。
- Memcached服务之间都是独立的，不支持集群。Redis内置对集群的支持。

#### 缓存穿透
###### *定义*
所谓缓存穿透，就是访问根本不存在的数据。当访问一个数据时，缓存不存在，则会直接查询数据库。数据库也不存在，就返回空。
如果有恶意用户访问大量不存在的数据，则会给数据库造成很大压力。
###### *解决方法*
- BloomFilter。类似于hash表的算法。把所有可能的查询生成一个bitmap。每次请求数据时，都通过BloomFilter查看数据是否存在。
- 缓存空值，并设置一个较短的过期时间。这样同个不存在的数据查询请求反复出现时，就能命中缓存。

#### 缓存雪崩
###### *定义*
缓存雪崩，就是缓存中大量数据同时失效。此时大量的数据请求就好转发到数据库，从而给数据库造成压力。
###### *解决方法*
- 让失效时间不同。比如一定范围的随机时间，这样就避免了大量缓存同时失效。缺点是粒度不好把握。
- 可以限制并发量（比如利用锁和同步机制）。这样即使缓存大量失效，也不会有大量请求造成数据库压力。不过这种方法造成了服务性能的下降。

#### 缓存击穿
###### *定义*
缓存击穿是缓存雪崩的特例。当某些热点数据失效时，它的请求会被发往数据库。在数据库请求并更新缓存的这段时间，如果有大量的热量请求，就会给数据库造成很大的压力。
###### *解决方法*
- 增加二级缓存，不同的缓存设置不同的失效时间。这个解决方案也适用于缓存雪崩。
- 基于LRU的缓存换出策略。

[Redis技术集](https://zhuanlan.zhihu.com/p/28073983)收集了一些Redis的技术讲解和使用场景按理。
[阿里云缓存架构](https://yq.aliyun.com/articles/290865)