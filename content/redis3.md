title: Redis系列三
subtitle: 持久化、集群、分区
date: 2019-09-21
status: draft 
category: Redis
tags: Redis

## 前述

本篇先讲解Redis持久化的两种方式：快照和AOF，然后讲解集群的工作原理和优缺点，最后谈谈分片的机制和应用。本篇内容主要是一些概念和理论上的知识，至于其中一些应用和常见解决方案，后面有必要会再单独写。

部分概念和内容来源于官网和其他网络博文，文中都有链接，可以跟随链接做扩展或深入了解。

## Redis持久化

## Redis集群

Redis集群是分片的一种实现方式，关于分片，请参考下面的小节。

## Redis分片

分片，就是将Redis数据分不到不同主机上，每个主机只拥有完整数据的一部分。

##### 分片优势

- 通过利用多台计算机内存的和值，允许我们构造更大的数据库。
- 通过多核和多台计算机，允许我们扩展计算能力；通过多台计算机和网络适配器，允许我们扩展网络带宽。

##### 分片缺点

- 涉及多个key的操作通常是不被支持的。举例来说，当两个set映射到不同的redis实例上时，你就不能对这两个set执行交集操作。
- 涉及多个key的redis事务不能使用。
- 当使用分区时，数据处理较为复杂，比如你需要处理多个rdb/aof文件，并且从多个实例和主机备份持久化文件。
- 增加或删除容量也比较复杂。

##### Redis支持的分片类型

1）范围分区

这种方式实现简单，只管，但是需要管理一个区间范围到实例的映射表。

2）哈希分区

这种方式高效，不需要管理映射表。但是可能数据比较分散。

##### 分区的不同实现

- 客户端分片(Client side partitioning)意味着，客户端直接选择正确的节点来写入和读取指定键。许多 Redis 客户端实现了客户端分片。

- 代理协助分片(Proxy assisted partitioning)意味着，我们的客户端发送请求到一个可以理解 Redis协议的代理上，而不是直接发送请求到Redis实例上。代理会根据配置好的分片模式，来保证转发我们的请求到正确的Redis实例，并返回响应给客户端。Redis和Memcached的代理Twemproxy实现了代理协助的分片。

- 查询路由(Query routing)意味着，你可以发送你的查询到一个随机实例，这个实例会保证转发你的查询到正确的节点。Redis 集群在客户端的帮助下，实现了查询路由的一种混合形式 (请求不是直接从 Redis 实例转发到另一个，而是客户端收到重定向到正确的节点)。

*以上分片小节内容摘录自官网和[Redis分片](https://www.cnblogs.com/houziwty/p/5167075.html)*

## 后述

*[Redis阻塞篇](https://blog.csdn.net/linbiaorui/article/details/79822318)*

*[Redis代理对比](https://www.jianshu.com/p/dfd28d3b545f)*

*[拼团demo]()*